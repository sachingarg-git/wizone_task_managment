<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wizone IT Support Portal</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; color: white; overflow-x: hidden;
            position: fixed; width: 100%; height: 100%;
        }
        
        /* Loading Screen */
        .loading-screen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 3000; transition: opacity 0.5s ease;
        }
        .loading-icon { font-size: 80px; animation: pulse 2s infinite; }
        .loading-text { font-size: 24px; color: #22d3ee; margin-top: 20px; font-weight: 600; }
        .loading-subtitle { font-size: 16px; margin-top: 8px; opacity: 0.8; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        
        /* Login Screen */
        .login-screen { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            flex-direction: column; justify-content: center; align-items: center;
            z-index: 2000; padding: 20px;
        }
        .login-form { 
            background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px; padding: 30px; width: 100%; max-width: 350px;
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
        }
        .login-logo { text-align: center; margin-bottom: 20px; }
        .login-logo-icon { font-size: 64px; margin-bottom: 10px; }
        .login-title { font-size: 24px; text-align: center; margin-bottom: 30px; color: #22d3ee; }
        .input-group { margin-bottom: 20px; }
        .input-label { display: block; margin-bottom: 8px; font-size: 14px; }
        .input-field { 
            width: 100%; padding: 12px 16px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1); color: white; font-size: 16px;
        }
        .input-field::placeholder { color: rgba(255,255,255,0.7); }
        .login-btn {
            width: 100%; padding: 15px; border-radius: 12px; border: none;
            background: #22d3ee; color: white; font-size: 16px; font-weight: 600;
            cursor: pointer; transition: all 0.3s ease;
        }
        .login-btn:active { transform: scale(0.98); }
        .demo-info {
            margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1);
            border-radius: 12px; text-align: center; font-size: 12px;
        }
        
        /* Dashboard Screen */
        .dashboard-screen { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            flex-direction: column; padding: 20px;
        }
        .dashboard-header { 
            background: rgba(255,255,255,0.1); border-radius: 16px; padding: 20px; 
            margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
        }
        .user-info { }
        .user-name { font-size: 18px; font-weight: 600; margin-bottom: 4px; }
        .user-role { font-size: 14px; opacity: 0.8; }
        .logout-btn { 
            background: rgba(255,255,255,0.2); border: none; color: white; 
            padding: 10px 16px; border-radius: 8px; font-size: 14px; cursor: pointer;
        }
        
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 20px; }
        .dashboard-card { 
            background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px; padding: 20px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-align: center; cursor: pointer;
            transition: all 0.3s ease; backdrop-filter: blur(10px);
            min-height: 120px;
        }
        .dashboard-card:active { transform: scale(0.98); background: rgba(255,255,255,0.25); }
        .card-icon { font-size: 40px; margin-bottom: 12px; }
        .card-title { font-size: 16px; font-weight: 600; margin-bottom: 6px; }
        .card-desc { font-size: 12px; opacity: 0.8; }
        
        .stats-section {
            background: rgba(255,255,255,0.1); border-radius: 16px; padding: 20px;
            backdrop-filter: blur(10px);
        }
        .stats-title { font-size: 18px; font-weight: 600; margin-bottom: 16px; text-align: center; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
        .stat-item { text-align: center; }
        .stat-number { font-size: 24px; font-weight: 700; color: #22d3ee; margin-bottom: 4px; }
        .stat-label { font-size: 12px; opacity: 0.8; }
        
        /* Task Screen */
        .task-screen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            flex-direction: column; padding: 20px;
        }
        .task-header {
            background: rgba(255,255,255,0.1); border-radius: 16px; padding: 16px;
            margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;
            backdrop-filter: blur(10px);
        }
        .back-btn {
            background: rgba(255,255,255,0.2); border: none; color: white;
            padding: 8px 12px; border-radius: 8px; font-size: 14px; cursor: pointer;
        }
        .task-content {
            background: rgba(255,255,255,0.1); border-radius: 16px; padding: 20px;
            flex: 1; overflow-y: auto; backdrop-filter: blur(10px);
        }
        .task-item {
            background: rgba(255,255,255,0.1); border-radius: 12px; padding: 16px;
            margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.2);
            cursor: pointer; transition: all 0.3s ease;
        }
        .task-item:active { background: rgba(255,255,255,0.2); }
        .task-id { font-size: 12px; color: #22d3ee; margin-bottom: 4px; }
        .task-title { font-weight: 600; margin-bottom: 4px; }
        .task-desc { font-size: 14px; opacity: 0.9; margin-bottom: 8px; }
        .task-status { 
            display: inline-block; padding: 4px 8px; border-radius: 6px; font-size: 12px;
            background: rgba(34,197,94,0.3); color: #10b981;
        }
        .task-priority { 
            display: inline-block; padding: 4px 8px; border-radius: 6px; font-size: 12px;
            margin-left: 8px; background: rgba(239,68,68,0.3); color: #f87171;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-icon">üì±</div>
        <div class="loading-text">Wizone IT Support</div>
        <div class="loading-subtitle">‡§µ‡§ø‡§ú‡§º‡•ã‡§® ‡§Ü‡§à‡§ü‡•Ä ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤</div>
    </div>
    
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-form">
            <div class="login-logo">
                <div class="login-logo-icon">üè¢</div>
                <div class="login-title">User Login</div>
                <div style="font-size: 14px; opacity: 0.8;">‡§Ø‡•Ç‡§ú‡§∞ ‡§≤‡•â‡§ó‡§ø‡§®</div>
            </div>
            <div class="input-group">
                <label class="input-label">Username / ‡§Ø‡•Ç‡§ú‡§∞‡§®‡•á‡§Æ</label>
                <input type="text" class="input-field" id="username" placeholder="Enter username" value="sachin">
            </div>
            <div class="input-group">
                <label class="input-label">Password / ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</label>
                <input type="password" class="input-field" id="password" placeholder="Enter password" value="admin123">
            </div>
            <button class="login-btn" onclick="handleLogin()">Login / ‡§≤‡•â‡§ó‡§ø‡§®</button>
            <div class="demo-info">
                Demo Credentials:<br>
                Username: sachin | Password: admin123<br>
                ‡§Ø‡•Ç‡§ú‡§∞‡§®‡•á‡§Æ: sachin | ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°: admin123
            </div>
        </div>
    </div>
    
    <!-- Dashboard Screen -->
    <div class="dashboard-screen" id="dashboardScreen">
        <div class="dashboard-header">
            <div class="user-info">
                <div class="user-name">üëã <span id="loggedUserName">User</span></div>
                <div class="user-role"><span id="loggedUserRole">Engineer</span></div>
            </div>
            <button class="logout-btn" onclick="handleLogout()">Logout</button>
        </div>
        
        <div class="dashboard-grid">
            <div class="dashboard-card" onclick="openTasks()">
                <div class="card-icon">üìã</div>
                <div class="card-title">My Tasks</div>
                <div class="card-desc">‡§Æ‡•á‡§∞‡•á ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§¶‡•á‡§ñ‡•á‡§Ç</div>
            </div>
            
            <div class="dashboard-card" onclick="openCustomers()">
                <div class="card-icon">üë•</div>
                <div class="card-title">Customers</div>
                <div class="card-desc">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§∏‡•Ç‡§ö‡•Ä</div>
            </div>
            
            <div class="dashboard-card" onclick="openReports()">
                <div class="card-icon">üìä</div>
                <div class="card-title">Reports</div>
                <div class="card-desc">‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§¶‡•á‡§ñ‡•á‡§Ç</div>
            </div>
            
            <div class="dashboard-card" onclick="openWebPortal()">
                <div class="card-icon">üåê</div>
                <div class="card-title">Web Portal</div>
                <div class="card-desc">‡§™‡•Ç‡§∞‡•ç‡§£ ‡§µ‡•á‡§¨ ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤</div>
            </div>
        </div>
        
        <div class="stats-section">
            <div class="stats-title">üìä Live Statistics</div>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number" id="myTasks">8</div>
                    <div class="stat-label">My Tasks</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="completed">15</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="pending">3</div>
                    <div class="stat-label">Pending</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Task Screen -->
    <div class="task-screen" id="taskScreen">
        <div class="task-header">
            <button class="back-btn" onclick="goBackToDashboard()">‚Üê Back</button>
            <div id="taskTitle">My Tasks</div>
            <div></div>
        </div>
        <div class="task-content" id="taskContent">
            <!-- Task list will be loaded here -->
        </div>
    </div>

    <script>
        // User database
        const users = {
            'admin': { password: 'admin123', name: 'Admin User', role: 'Administrator' },
            'sachin': { password: 'admin123', name: 'Sachin Kumar', role: 'Field Engineer' },
            'manpreet': { password: 'admin123', name: 'Manpreet Singh', role: 'Manager' },
            'engineer': { password: 'pass123', name: 'Support Engineer', role: 'Engineer' }
        };
        
        // Task database for logged user
        const userTasks = {
            'sachin': [
                {
                    id: 'T23501',
                    title: 'Server Maintenance - Data Center',
                    description: '‡§°‡•á‡§ü‡§æ ‡§∏‡•á‡§Ç‡§ü‡§∞ ‡§Æ‡•á‡§Ç ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§∞‡§ñ‡§∞‡§ñ‡§æ‡§µ ‡§î‡§∞ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡§æ ‡§π‡•à',
                    status: 'In Progress',
                    priority: 'High',
                    customer: 'ABC Corporation'
                },
                {
                    id: 'T23502',
                    title: 'Network Setup - Branch Office',
                    description: '‡§®‡§à ‡§¨‡•ç‡§∞‡§æ‡§Ç‡§ö ‡§ë‡§´‡§ø‡§∏ ‡§Æ‡•á‡§Ç ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§∏‡•á‡§ü‡§Ö‡§™',
                    status: 'Assigned',
                    priority: 'Medium',
                    customer: 'XYZ Business'
                },
                {
                    id: 'T23503',
                    title: 'Software Installation',
                    description: '‡§ï‡•ç‡§≤‡§æ‡§á‡§Ç‡§ü ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡•á‡§Ç ‡§®‡§Ø‡§æ ‡§∏‡•â‡§´‡•ç‡§ü‡§µ‡•á‡§Ø‡§∞ ‡§á‡§Ç‡§∏‡•ç‡§ü‡•â‡§≤ ‡§ï‡§∞‡§®‡§æ',
                    status: 'Pending',
                    priority: 'Low',
                    customer: 'Tech Solutions'
                },
                {
                    id: 'T23504',
                    title: 'Hardware Replacement',
                    description: '‡§°‡•à‡§Æ‡•á‡§ú ‡§π‡§æ‡§∞‡•ç‡§°‡§µ‡•á‡§Ø‡§∞ ‡§ï‡•ã ‡§∞‡§ø‡§™‡•ç‡§≤‡•á‡§∏ ‡§ï‡§∞‡§®‡§æ ‡§π‡•à',
                    status: 'Completed',
                    priority: 'High',
                    customer: 'Digital Hub'
                }
            ]
        };
        
        let currentUser = null;
        let currentScreen = 'loading';
        
        // App initialization
        window.addEventListener('load', function() {
            setTimeout(function() {
                showScreen('login');
            }, 2000);
        });
        
        function showScreen(screen) {
            // Hide all screens
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboardScreen').style.display = 'none';
            document.getElementById('taskScreen').style.display = 'none';
            
            // Show selected screen
            if (screen === 'login') {
                document.getElementById('loginScreen').style.display = 'flex';
            } else if (screen === 'dashboard') {
                document.getElementById('dashboardScreen').style.display = 'flex';
            } else if (screen === 'tasks') {
                document.getElementById('taskScreen').style.display = 'flex';
            }
            currentScreen = screen;
        }
        
        async function handleLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                alert('‚ö†Ô∏è Please enter username and password\n‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ø‡•Ç‡§ú‡§∞‡§®‡•á‡§Æ ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç');
                return;
            }
            
            try {
                const baseUrl = window.location.origin || 'https://299f0612-89c3-4a4f-9a65-3dd9be12e804-00-3u4fqy7m2q8tl.picard.replit.dev';
                
                // Attempt live authentication with backend
                const response = await fetch(`${baseUrl}/api/auth/login`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });
                
                if (response.ok) {
                    const userData = await response.json();
                    currentUser = userData.user;
                    document.getElementById('loggedUserName').textContent = currentUser.firstName + ' ' + currentUser.lastName;
                    document.getElementById('loggedUserRole').textContent = currentUser.role;
                    
                    // Update stats based on real user
                    await updateUserStatsFromAPI();
                    
                    showScreen('dashboard');
                    
                    // Clear login form
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                    
                    console.log('‚úÖ Live login successful:', currentUser.firstName);
                } else {
                    // Fallback to offline authentication
                    if (users[username] && users[username].password === password) {
                        currentUser = { username, ...users[username] };
                        document.getElementById('loggedUserName').textContent = currentUser.name;
                        document.getElementById('loggedUserRole').textContent = currentUser.role;
                        
                        updateUserStats();
                        showScreen('dashboard');
                        
                        document.getElementById('username').value = '';
                        document.getElementById('password').value = '';
                        
                        console.log('üì° Offline login successful:', currentUser.name);
                    } else {
                        alert('‚ùå Invalid credentials\n‡§ó‡§≤‡§§ ‡§Ø‡•Ç‡§ú‡§∞‡§®‡•á‡§Æ ‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°');
                    }
                }
            } catch (error) {
                console.log('Network error, using offline authentication:', error);
                // Fallback to offline authentication
                if (users[username] && users[username].password === password) {
                    currentUser = { username, ...users[username] };
                    document.getElementById('loggedUserName').textContent = currentUser.name;
                    document.getElementById('loggedUserRole').textContent = currentUser.role;
                    
                    updateUserStats();
                    showScreen('dashboard');
                    
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                    
                    console.log('üì° Offline login successful:', currentUser.name);
                } else {
                    alert('‚ùå Invalid credentials\n‡§ó‡§≤‡§§ ‡§Ø‡•Ç‡§ú‡§∞‡§®‡•á‡§Æ ‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°');
                }
            }
        }
        
        function handleLogout() {
            if (confirm('üö™ Logout from Wizone Portal?\n‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
                currentUser = null;
                showScreen('login');
                document.getElementById('username').value = 'sachin';
                document.getElementById('password').value = 'admin123';
            }
        }
        
        async function updateUserStatsFromAPI() {
            try {
                const baseUrl = window.location.origin || 'https://299f0612-89c3-4a4f-9a65-3dd9be12e804-00-3u4fqy7m2q8tl.picard.replit.dev';
                const response = await fetch(`${baseUrl}/api/dashboard/stats`, {
                    method: 'GET',
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    const stats = await response.json();
                    document.getElementById('myTasks').textContent = stats.totalTasks || 0;
                    document.getElementById('completed').textContent = stats.completedTasks || 0;
                    document.getElementById('pending').textContent = stats.pendingTasks || 0;
                } else {
                    updateUserStats(); // Fallback to offline stats
                }
            } catch (error) {
                updateUserStats(); // Fallback to offline stats
            }
        }
        
        function updateUserStats() {
            if (currentUser && userTasks[currentUser.username]) {
                const tasks = userTasks[currentUser.username];
                const completed = tasks.filter(t => t.status === 'Completed').length;
                const pending = tasks.filter(t => t.status === 'Pending' || t.status === 'Assigned').length;
                
                document.getElementById('myTasks').textContent = tasks.length;
                document.getElementById('completed').textContent = completed;
                document.getElementById('pending').textContent = pending;
            }
        }
        
        function openTasks() {
            document.getElementById('taskTitle').textContent = 'üìã My Tasks';
            loadUserTasksFromAPI();
            showScreen('tasks');
        }
        
        async function loadUserTasksFromAPI() {
            const content = document.getElementById('taskContent');
            content.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 48px; margin-bottom: 16px; animation: pulse 2s infinite;">‚è≥</div>
                    <div>Loading tasks...</div>
                    <div style="font-size: 14px; margin-top: 8px;">‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</div>
                </div>
            `;
            
            try {
                // Get current deployment URL dynamically
                const baseUrl = window.location.origin || 'https://299f0612-89c3-4a4f-9a65-3dd9be12e804-00-3u4fqy7m2q8tl.picard.replit.dev';
                
                // Fetch tasks from live API
                const response = await fetch(`${baseUrl}/api/tasks`, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const tasks = await response.json();
                    displayTasks(tasks);
                } else {
                    // Fallback to offline data if API fails
                    console.log('API failed, using offline data');
                    loadUserTasksOffline();
                }
            } catch (error) {
                console.log('Network error, using offline data:', error);
                loadUserTasksOffline();
            }
        }
        
        function displayTasks(tasks) {
            const content = document.getElementById('taskContent');
            
            if (tasks && tasks.length > 0) {
                let html = '';
                
                tasks.forEach(task => {
                    const statusColor = task.status === 'completed' ? 'rgba(34,197,94,0.3)' : 
                                       task.status === 'in_progress' ? 'rgba(59,130,246,0.3)' : 
                                       task.status === 'assigned' ? 'rgba(245,158,11,0.3)' :
                                       'rgba(239,68,68,0.3)';
                    const statusTextColor = task.status === 'completed' ? '#10b981' : 
                                           task.status === 'in_progress' ? '#3b82f6' : 
                                           task.status === 'assigned' ? '#f59e0b' :
                                           '#f87171';
                    
                    const statusText = task.status === 'completed' ? 'Completed' :
                                      task.status === 'in_progress' ? 'In Progress' :
                                      task.status === 'assigned' ? 'Assigned' : 
                                      task.status === 'pending' ? 'Pending' : 'New';
                    
                    const priorityText = task.priority === 'high' ? 'High' :
                                        task.priority === 'medium' ? 'Medium' : 'Low';
                    
                    html += `
                        <div class="task-item" onclick="openTaskDetails('${task.ticketNumber}', '${task.title}', '${statusText}', '${priorityText}', '${task.description || 'No description'}')">
                            <div class="task-id">${task.ticketNumber}</div>
                            <div class="task-title">${task.title}</div>
                            <div class="task-desc">${task.description || '‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à'}</div>
                            <div class="task-status" style="background: ${statusColor}; color: ${statusTextColor}">
                                ${statusText}
                            </div>
                            <div class="task-priority">${priorityText} Priority</div>
                            <div style="margin-top: 8px; font-size: 12px; opacity: 0.8;">
                                Customer: ${task.customerId || 'N/A'}
                            </div>
                        </div>
                    `;
                });
                
                content.innerHTML = html;
            } else {
                content.innerHTML = `
                    <div style="text-align: center; padding: 40px; opacity: 0.7;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üìã</div>
                        <div>No tasks found</div>
                        <div style="font-size: 14px; margin-top: 8px;">‡§ï‡•ã‡§à ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ</div>
                    </div>
                `;
            }
        }
        
        function loadUserTasksOffline() {
            const content = document.getElementById('taskContent');
            
            if (currentUser && userTasks[currentUser.username]) {
                const tasks = userTasks[currentUser.username];
                let html = '';
                
                tasks.forEach(task => {
                    const statusColor = task.status === 'Completed' ? 'rgba(34,197,94,0.3)' : 
                                       task.status === 'In Progress' ? 'rgba(59,130,246,0.3)' : 
                                       'rgba(239,68,68,0.3)';
                    const statusTextColor = task.status === 'Completed' ? '#10b981' : 
                                           task.status === 'In Progress' ? '#3b82f6' : 
                                           '#f87171';
                    
                    html += `
                        <div class="task-item" onclick="openTaskDetails('${task.id}', '${task.title}', '${task.status}', '${task.priority}', '${task.description}')">
                            <div class="task-id">${task.id}</div>
                            <div class="task-title">${task.title}</div>
                            <div class="task-desc">${task.description}</div>
                            <div class="task-status" style="background: ${statusColor}; color: ${statusTextColor}">
                                ${task.status}
                            </div>
                            <div class="task-priority">${task.priority} Priority</div>
                            <div style="margin-top: 8px; font-size: 12px; opacity: 0.8;">
                                Customer: ${task.customer}
                            </div>
                        </div>
                    `;
                });
                
                content.innerHTML = html + `
                    <div style="text-align: center; margin-top: 20px; padding: 16px; background: rgba(245,158,11,0.2); border-radius: 12px; color: #f59e0b;">
                        üì° Offline Mode - Showing sample data
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div style="text-align: center; padding: 40px; opacity: 0.7;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üìã</div>
                        <div>No tasks assigned</div>
                        <div style="font-size: 14px; margin-top: 8px;">‡§ï‡•ã‡§à ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§Ö‡§∏‡§æ‡§á‡§® ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</div>
                    </div>
                `;
            }
        }
        
        function openTaskDetails(taskId, title, status, priority, description) {
            const statusOptions = ['pending', 'assigned', 'in_progress', 'completed', 'cancelled'];
            const statusHindi = {
                'pending': '‡§≤‡§Ç‡§¨‡§ø‡§§',
                'assigned': '‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ',
                'in_progress': '‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§Æ‡•á‡§Ç',
                'completed': '‡§™‡•Ç‡§∞‡•ç‡§£',
                'cancelled': '‡§∞‡§¶‡•ç‡§¶'
            };
            
            let statusChoice = prompt(`üìã Task: ${title}\n\nCurrent Status: ${status}\nID: ${taskId}\nPriority: ${priority}\n\nDescription: ${description}\n\nüîÑ Change Status?\n\nEnter new status:\n1 = Pending (‡§≤‡§Ç‡§¨‡§ø‡§§)\n2 = Assigned (‡§Ö‡§∏‡§æ‡§á‡§®)\n3 = In Progress (‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§Æ‡•á‡§Ç)\n4 = Completed (‡§™‡•Ç‡§∞‡•ç‡§£)\n5 = Cancelled (‡§∞‡§¶‡•ç‡§¶)\n\nEnter 1-5 or press Cancel to close:`);
            
            if (statusChoice && statusChoice >= '1' && statusChoice <= '5') {
                const newStatus = statusOptions[parseInt(statusChoice) - 1];
                updateTaskStatus(taskId, newStatus, title);
            }
        }
        
        async function updateTaskStatus(taskId, newStatus, taskTitle) {
            try {
                const baseUrl = window.location.origin || 'https://299f0612-89c3-4a4f-9a65-3dd9be12e804-00-3u4fqy7m2q8tl.picard.replit.dev';
                const response = await fetch(`${baseUrl}/api/tasks/${taskId}`, {
                    method: 'PATCH',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        status: newStatus,
                        note: `Status updated via mobile app by ${currentUser.firstName || currentUser.name || currentUser.username}`
                    })
                });
                
                if (response.ok) {
                    const statusHindi = {
                        'pending': '‡§≤‡§Ç‡§¨‡§ø‡§§',
                        'assigned': '‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ',
                        'in_progress': '‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§Æ‡•á‡§Ç',
                        'completed': '‡§™‡•Ç‡§∞‡•ç‡§£',
                        'cancelled': '‡§∞‡§¶‡•ç‡§¶'
                    };
                    
                    alert(`‚úÖ Task Updated!\n\nTask: ${taskTitle}\nNew Status: ${newStatus.replace('_', ' ').toUpperCase()}\nHindi: ${statusHindi[newStatus]}\n\nüìä Updated in SQL Server Database\nüîÑ Refreshing task list...`);
                    
                    // Refresh task list
                    loadUserTasksFromAPI();
                    
                    // Update stats
                    if (currentUser.firstName) {
                        await updateUserStatsFromAPI();
                    } else {
                        updateUserStats();
                    }
                } else {
                    alert('‚ùå Failed to update task\n‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§Ö‡§™‡§°‡•á‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§∏‡§ï‡§æ');
                }
            } catch (error) {
                alert('‚ùå Network error\n‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø');
                console.log('Update error:', error);
            }
        }
        
        async function openCustomers() {
            try {
                const baseUrl = window.location.origin || 'https://299f0612-89c3-4a4f-9a65-3dd9be12e804-00-3u4fqy7m2q8tl.picard.replit.dev';
                const response = await fetch(`${baseUrl}/api/customers`, {
                    method: 'GET',
                    credentials: 'include',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    const customers = await response.json();
                    let customerList = 'üë• Live Customer Data\n\n';
                    customers.slice(0, 5).forEach(customer => {
                        customerList += `üè¢ ${customer.name}\nüìß ${customer.email}\nüì± ${customer.phone}\nüìç ${customer.address}\n\n`;
                    });
                    customerList += '‚úÖ Data from SQL Server Database';
                    alert(customerList);
                } else {
                    alert('üë• Customer Portal\n\nüè¢ ABC Corporation - Enterprise Plan\nüè™ XYZ Business - Professional Plan\nüíº Tech Solutions - Basic Plan\nüöÄ Digital Services - Premium Plan\nüìà StartUp Hub - Growth Plan\n\nüì° Offline Mode');
                }
            } catch (error) {
                alert('üë• Customer Portal\n\nüè¢ ABC Corporation - Enterprise Plan\nüè™ XYZ Business - Professional Plan\nüíº Tech Solutions - Basic Plan\nüöÄ Digital Services - Premium Plan\nüìà StartUp Hub - Growth Plan\n\nüì° Offline Mode');
            }
        }
        
        function openReports() {
            alert('üìä Performance Reports\n\nüìà Task Completion: 85%\n‚≠ê Customer Satisfaction: 4.2/5\n‚è±Ô∏è Response Time: 2.3 hours\nüë®‚Äçüíª Active Engineers: 12\nüéØ Monthly Target: 92%\n\n‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§® ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü - ‡§∏‡§≠‡•Ä ‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏');
        }
        
        function openWebPortal() {
            const url = window.location.origin || 'https://299f0612-89c3-4a4f-9a65-3dd9be12e804-00-3u4fqy7m2q8tl.picard.replit.dev';
            
            if (confirm('üåê Open Full Web Portal?\n\nThis will open the complete Wizone IT Support Portal with all features.\n\n‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§µ‡•á‡§¨ ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤ ‡§ñ‡•ã‡§≤‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
                window.open(url, '_blank');
            }
        }
        
        function goBackToDashboard() {
            showScreen('dashboard');
        }
        
        // Auto-update stats every 15 seconds
        setInterval(function() {
            if (currentScreen === 'dashboard' && currentUser) {
                if (currentUser.firstName) {
                    updateUserStatsFromAPI(); // Live stats
                } else {
                    updateUserStats(); // Offline stats
                }
            }
        }, 15000);
        
        // Auto-refresh tasks every 30 seconds if on tasks screen
        setInterval(function() {
            if (currentScreen === 'tasks' && currentUser) {
                console.log('üîÑ Auto-refreshing tasks...');
                loadUserTasksFromAPI();
            }
        }, 30000);
        
        console.log('‚úÖ Wizone Mobile App Initialized');
        console.log('üîê Multi-user login system active');
        console.log('üì± Task management ready');
        console.log('üéØ User-specific data loading enabled');
    </script>
</body>
</html>