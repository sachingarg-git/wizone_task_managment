<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wizone Field Engineer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; color: white; display: flex; align-items: center; justify-content: center;
        }
        
        .login-container {
            background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px; padding: 40px; width: 100%; max-width: 350px;
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
        }
        
        .logo { text-align: center; margin-bottom: 30px; }
        .logo-icon { 
            width: 80px; height: 80px; background: #22d3ee; border-radius: 20px;
            display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;
            font-size: 36px; font-weight: bold; color: white;
        }
        .app-title { font-size: 20px; text-align: center; color: #22d3ee; margin-bottom: 10px; }
        .app-subtitle { font-size: 14px; text-align: center; opacity: 0.8; }
        
        .input-group { margin-bottom: 20px; }
        .input-label { display: block; margin-bottom: 8px; font-size: 14px; }
        .input-field { 
            width: 100%; padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1); color: white; font-size: 16px;
        }
        .input-field::placeholder { color: rgba(255,255,255,0.7); }
        
        .login-btn {
            width: 100%; padding: 15px; border-radius: 12px; border: none;
            background: #22d3ee; color: white; font-size: 16px; font-weight: 600;
            cursor: pointer; transition: all 0.3s ease; margin-bottom: 15px;
        }
        .login-btn:active { transform: scale(0.98); }
        .login-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .status-message {
            text-align: center; padding: 12px; border-radius: 8px; margin-bottom: 15px;
            font-size: 14px; display: none;
        }
        .status-success { background: rgba(34, 197, 94, 0.2); border: 1px solid rgba(34, 197, 94, 0.5); }
        .status-error { background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.5); }
        .status-info { background: rgba(59, 130, 246, 0.2); border: 1px solid rgba(59, 130, 246, 0.5); }
        
        .server-status { 
            text-align: center; font-size: 12px; opacity: 0.7; 
            margin-top: 20px; padding: 10px;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="logo">
            <div class="logo-icon">W</div>
            <div class="app-title">Field Engineer Portal</div>
            <div class="app-subtitle">Real-time Task Management</div>
        </div>
        
        <div id="statusMessage" class="status-message"></div>
        
        <div class="input-group">
            <label class="input-label">Username</label>
            <input type="text" id="username" class="input-field" placeholder="Enter username" value="wizone124">
        </div>
        
        <div class="input-group">
            <label class="input-label">Password</label>
            <input type="password" id="password" class="input-field" placeholder="Enter password" value="admin123">
        </div>
        
        <button id="loginBtn" class="login-btn" onclick="performLogin()">Login to Portal</button>
        
        <div class="server-status">
            <div id="serverStatus">Checking server connection...</div>
            <div id="networkInfo"></div>
        </div>
    </div>

    <script>
        // Direct server configuration - NO complex detection
        const SERVER_URL = 'https://window.299f0612-89c3-4a4f-9a65-3dd9be12e804-00-3u4fqy7m2q8tl.picard.replit.dev';
        
        let isConnected = false;
        
        // Show status message
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type}`;
            statusEl.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 3000);
            }
        }
        
        // Update server status
        function updateServerStatus(status, details = '') {
            document.getElementById('serverStatus').textContent = status;
            document.getElementById('networkInfo').textContent = details;
        }
        
        // Test server connection
        async function testConnection() {
            try {
                updateServerStatus('Testing connection...', 'Please wait...');
                
                const response = await fetch(`${SERVER_URL}/api/health`, {
                    method: 'GET',
                    headers: {
                        'User-Agent': 'WizoneFieldEngineerApp/1.0 (Mobile)',
                        'Accept': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    isConnected = true;
                    updateServerStatus('‚úÖ Server connected', `Status: ${data.status || 'OK'}`);
                    showStatus('Server connection successful', 'success');
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                isConnected = false;
                updateServerStatus('‚ùå Connection failed', `Error: ${error.message}`);
                showStatus('Unable to connect to server. Check internet connection.', 'error');
                return false;
            }
        }
        
        // Perform login
        async function performLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const loginBtn = document.getElementById('loginBtn');
            
            if (!username || !password) {
                showStatus('Please enter username and password', 'error');
                return;
            }
            
            // Test connection first if not already connected
            if (!isConnected) {
                const connected = await testConnection();
                if (!connected) {
                    showStatus('Cannot connect to server. Please check your internet connection.', 'error');
                    return;
                }
            }
            
            try {
                loginBtn.disabled = true;
                loginBtn.textContent = 'Logging in...';
                showStatus('Authenticating...', 'info');
                
                console.log(`üîê Attempting login: ${username}`);
                console.log(`üåê Server URL: ${SERVER_URL}`);
                
                const response = await fetch(`${SERVER_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'User-Agent': 'WizoneFieldEngineerApp/1.0 (Mobile)',
                        'X-Requested-With': 'mobile'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ username, password })
                });
                
                console.log(`üì° Response status: ${response.status}`);
                
                if (response.ok) {
                    const userData = await response.json();
                    console.log(`‚úÖ Login successful:`, userData);
                    
                    showStatus(`Welcome ${userData.username}! Redirecting...`, 'success');
                    
                    // Store user data
                    localStorage.setItem('wizone_user', JSON.stringify(userData));
                    localStorage.setItem('wizone_server', SERVER_URL);
                    
                    // Redirect to main app after short delay
                    setTimeout(() => {
                        window.location.href = `${SERVER_URL}?mobile=true&logged_in=true`;
                    }, 2000);
                    
                } else {
                    const errorText = await response.text();
                    console.log(`‚ùå Login failed: ${response.status} - ${errorText}`);
                    showStatus(`Login failed: ${errorText || 'Invalid credentials'}`, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Login error:', error);
                showStatus(`Network error: ${error.message}`, 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'Login to Portal';
            }
        }
        
        // Handle Enter key
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performLogin();
            }
        });
        
        // Test connection on load
        window.addEventListener('load', function() {
            console.log('üöÄ Wizone Field Engineer App - Direct Login');
            console.log(`üåê Target server: ${SERVER_URL}`);
            
            // Test connection after 1 second
            setTimeout(testConnection, 1000);
        });
    </script>
</body>
</html>