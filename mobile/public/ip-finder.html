<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Server IP</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; color: white; padding: 20px;
        }
        
        .container {
            max-width: 400px; margin: 0 auto;
            background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px; padding: 30px;
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
        }
        
        .header { text-align: center; margin-bottom: 30px; }
        .logo { 
            width: 60px; height: 60px; background: #22d3ee; border-radius: 12px;
            display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;
            font-size: 24px; font-weight: bold; color: white;
        }
        .title { font-size: 18px; color: #22d3ee; margin-bottom: 5px; }
        .subtitle { font-size: 13px; opacity: 0.8; }
        
        .ip-detector {
            background: rgba(255,255,255,0.1); padding: 20px; border-radius: 12px; 
            margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.2);
        }
        
        .input-group { margin-bottom: 15px; }
        .label { display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; }
        .input { 
            width: 100%; padding: 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1); color: white; font-size: 15px;
        }
        .input::placeholder { color: rgba(255,255,255,0.6); }
        
        .btn {
            width: 100%; padding: 12px; border-radius: 10px; border: none;
            background: #22d3ee; color: white; font-size: 14px; font-weight: 600;
            cursor: pointer; transition: all 0.3s ease; margin-bottom: 10px;
        }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .result {
            padding: 15px; border-radius: 10px; margin-bottom: 15px;
            font-size: 13px; display: none;
        }
        .success { background: rgba(34, 197, 94, 0.2); border: 1px solid rgba(34, 197, 94, 0.5); }
        .error { background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.5); }
        
        .instructions {
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; 
            font-size: 12px; line-height: 1.4; margin-bottom: 20px;
        }
        
        .ip-list { margin-top: 15px; }
        .ip-item {
            background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px;
            margin-bottom: 8px; font-size: 12px;
        }
        .ip-address { 
            font-family: 'Courier New', monospace; color: #22d3ee; 
            font-weight: bold; font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üì°</div>
            <div class="title">Server IP Finder</div>
            <div class="subtitle">Find your computer's IP for mobile connection</div>
        </div>
        
        <div class="instructions">
            <strong>üì± Steps to Connect Mobile APK:</strong><br>
            1. Find your computer's IP address below<br>
            2. Test the connection<br>
            3. Update mobile configuration with correct IP<br>
            4. Rebuild APK and test
        </div>
        
        <div class="ip-detector">
            <div class="input-group">
                <label class="label">üîç Auto-Detect Computer IP</label>
                <button class="btn" onclick="detectIP()">Find My Computer's IP Address</button>
            </div>
            
            <div class="input-group">
                <label class="label">üìù Manual IP Entry (if auto-detect fails)</label>
                <input type="text" id="manualIP" class="input" 
                       placeholder="192.168.1.105 ‡§Ø‡§æ 10.0.0.105" 
                       value="">
            </div>
            
            <button class="btn" onclick="testConnection()">Test Connection</button>
        </div>
        
        <div id="result" class="result"></div>
        
        <div id="ipList" class="ip-list" style="display: none;">
            <div style="font-size: 13px; margin-bottom: 10px; color: #22d3ee; font-weight: 600;">
                Available IP Addresses:
            </div>
        </div>
    </div>

    <script>
        function showResult(text, type) {
            const result = document.getElementById('result');
            result.innerHTML = text;
            result.className = `result ${type}`;
            result.style.display = 'block';
        }
        
        async function detectIP() {
            showResult('üîç Detecting your computer\'s IP addresses...', 'success');
            
            try {
                // Try to get IP using WebRTC
                const pc = new RTCPeerConnection({iceServers: []});
                pc.createDataChannel('');
                
                const ips = [];
                
                pc.onicecandidate = (ice) => {
                    if (!ice || !ice.candidate || !ice.candidate.candidate) return;
                    const candidate = ice.candidate.candidate;
                    const ipMatch = candidate.match(/([0-9]{1,3}(\.[0-9]{1,3}){3})/);
                    if (ipMatch) {
                        const ip = ipMatch[1];
                        if (ip !== '127.0.0.1' && !ips.includes(ip)) {
                            ips.push(ip);
                        }
                    }
                };
                
                await pc.createOffer();
                await pc.setLocalDescription();
                
                // Wait for ICE candidates
                setTimeout(() => {
                    pc.close();
                    
                    if (ips.length > 0) {
                        displayIPs(ips);
                    } else {
                        showResult('‚ùå Auto-detection failed. Please enter IP manually or check Windows command: <code>ipconfig</code>', 'error');
                    }
                }, 2000);
                
            } catch (error) {
                console.error('IP detection error:', error);
                showResult('‚ùå Auto-detection not supported. Please enter IP manually.', 'error');
            }
        }
        
        function displayIPs(ips) {
            const ipList = document.getElementById('ipList');
            ipList.innerHTML = '<div style="font-size: 13px; margin-bottom: 10px; color: #22d3ee; font-weight: 600;">Available IP Addresses:</div>';
            
            ips.forEach((ip, index) => {
                const ipItem = document.createElement('div');
                ipItem.className = 'ip-item';
                ipItem.innerHTML = `
                    <div>IP ${index + 1}: <span class="ip-address">${ip}</span></div>
                    <div style="font-size: 11px; opacity: 0.8; margin-top: 4px;">
                        Mobile URL: http://${ip}:5000
                    </div>
                    <button onclick="testSpecificIP('${ip}')" style="margin-top: 8px; padding: 4px 8px; background: #22d3ee; border: none; border-radius: 4px; color: white; font-size: 11px; cursor: pointer;">
                        Test This IP
                    </button>
                `;
                ipList.appendChild(ipItem);
            });
            
            ipList.style.display = 'block';
            
            // Set first IP as default
            document.getElementById('manualIP').value = ips[0];
            
            showResult(`‚úÖ Found ${ips.length} IP address(es). Test each one to find the working one.`, 'success');
        }
        
        async function testSpecificIP(ip) {
            await testConnectionWithIP(ip);
        }
        
        async function testConnection() {
            const ip = document.getElementById('manualIP').value.trim();
            if (!ip) {
                showResult('‚ùå Please enter an IP address or use auto-detect.', 'error');
                return;
            }
            await testConnectionWithIP(ip);
        }
        
        async function testConnectionWithIP(ip) {
            showResult(`üîÑ Testing connection to http://${ip}:5000...`, 'success');
            
            try {
                const response = await Promise.race([
                    fetch(`http://${ip}:5000/api/health`, {
                        method: 'GET',
                        headers: {
                            'User-Agent': 'WizoneIPFinder/1.0',
                            'Accept': 'application/json'
                        }
                    }),
                    new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Connection timeout')), 5000)
                    )
                ]);
                
                if (response && response.ok) {
                    const data = await response.json();
                    showResult(`
                        ‚úÖ <strong>SUCCESS! Your mobile APK should use this IP:</strong><br>
                        <div class="ip-address" style="margin: 10px 0;">${ip}</div>
                        Server Status: ${data.status || 'OK'}<br><br>
                        üì± <strong>Next Steps:</strong><br>
                        1. Update mobile config with IP: ${ip}<br>
                        2. Rebuild APK: <code>npx cap build android</code><br>
                        3. Install and test on mobile device
                    `, 'success');
                } else {
                    throw new Error(`HTTP ${response ? response.status : 'Unknown'}`);
                }
                
            } catch (error) {
                showResult(`
                    ‚ùå <strong>Connection Failed to ${ip}:5000</strong><br>
                    Error: ${error.message}<br><br>
                    üí° <strong>Troubleshooting:</strong><br>
                    ‚Ä¢ Check if server is running on port 5000<br>
                    ‚Ä¢ Ensure mobile and computer on same WiFi<br>
                    ‚Ä¢ Try Windows firewall: allow port 5000<br>
                    ‚Ä¢ Test in mobile browser: http://${ip}:5000
                `, 'error');
            }
        }
        
        // Auto-detect on load
        window.addEventListener('load', () => {
            console.log('üöÄ Wizone IP Finder loaded');
            
            // Common IP ranges for quick testing
            const commonIPs = ['192.168.1.', '192.168.0.', '10.0.0.', '172.16.'];
            showResult('Ready to find your computer\'s IP address. Click "Find My Computer\'s IP Address" to start.', 'success');
        });
    </script>
</body>
</html>