<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“± Mobile APK Connection Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f8ff; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 30px; }
        .server-info { background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 20px 0; border: 1px solid #28a745; }
        .test-button { background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; margin: 8px; }
        .test-button:hover { background: #0056b3; }
        .result { margin: 15px 0; padding: 15px; border-radius: 8px; font-family: monospace; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        #log { height: 300px; overflow-y: auto; background: #f8f9fa; border: 1px solid #ddd; padding: 15px; margin-top: 20px; border-radius: 6px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“± Mobile APK Connection Test</h1>
            <p>Testing connection to production server and authentication</p>
        </div>
        
        <div class="server-info">
            <strong>ğŸŒ Production Server:</strong> http://194.238.19.19:5000<br>
            <strong>ğŸ—„ï¸ Database:</strong> 103.122.85.61:1440/WIZONE_TASK_MANAGER<br>
            <strong>ğŸ”‘ Login Credentials:</strong> admin / admin123
        </div>

        <div style="text-align: center;">
            <button class="test-button" onclick="testServerConnection()">ğŸŒ Test Server Connection</button>
            <button class="test-button" onclick="testAuthentication()">ğŸ” Test Authentication</button>
            <button class="test-button" onclick="testDataAccess()">ğŸ“Š Test Data Access</button>
            <button class="test-button" onclick="runAllTests()" style="background: #28a745;">ğŸš€ Run All Tests</button>
            <button class="test-button" onclick="openMobileAPK()" style="background: #dc3545;">ğŸ“± Open Mobile APK</button>
        </div>

        <div id="results"></div>
        <div id="log"></div>
    </div>

    <script>
        const SERVER_URL = 'http://194.238.19.19:5000';
        let results = document.getElementById('results');
        let log = document.getElementById('log');
        let sessionCookie = null;

        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            log.innerHTML += `<div><strong>[${timestamp}]</strong> ${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        function showResult(message, success) {
            const result = document.createElement('div');
            result.className = `result ${success ? 'success' : 'error'}`;
            result.innerHTML = message;
            results.appendChild(result);
        }

        async function testServerConnection() {
            addLog('ğŸŒ Testing server connection...');
            try {
                const response = await fetch(`${SERVER_URL}/`, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    addLog(`âœ… Server responded: ${response.status}`);
                    showResult(`âœ… Server Connection: SUCCESS (${response.status})`, true);
                    return true;
                } else {
                    addLog(`âŒ Server error: ${response.status}`);
                    showResult(`âŒ Server Connection: FAILED (${response.status})`, false);
                    return false;
                }
            } catch (error) {
                addLog(`âŒ Connection failed: ${error.message}`);
                showResult(`âŒ Server Connection: FAILED - ${error.message}`, false);
                return false;
            }
        }

        async function testAuthentication() {
            addLog('ğŸ” Testing authentication with admin/admin123...');
            try {
                const response = await fetch(`${SERVER_URL}/api/auth/login`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });

                if (response.ok) {
                    const userData = await response.json();
                    sessionCookie = true;
                    addLog(`âœ… Login successful: ${userData.username} (${userData.role})`);
                    showResult(`âœ… Authentication: SUCCESS - Welcome ${userData.firstName} ${userData.lastName}`, true);
                    return true;
                } else {
                    addLog(`âŒ Login failed: ${response.status}`);
                    showResult(`âŒ Authentication: FAILED (${response.status})`, false);
                    return false;
                }
            } catch (error) {
                addLog(`âŒ Authentication error: ${error.message}`);
                showResult(`âŒ Authentication: FAILED - ${error.message}`, false);
                return false;
            }
        }

        async function testDataAccess() {
            if (!sessionCookie) {
                addLog('âš ï¸ Need to authenticate first...');
                if (!await testAuthentication()) {
                    return false;
                }
            }

            addLog('ğŸ“Š Testing data access...');
            try {
                const [tasksResponse, customersResponse] = await Promise.all([
                    fetch(`${SERVER_URL}/api/tasks`, { credentials: 'include' }),
                    fetch(`${SERVER_URL}/api/customers`, { credentials: 'include' })
                ]);

                if (tasksResponse.ok && customersResponse.ok) {
                    const tasksData = await tasksResponse.json();
                    const customersData = await customersResponse.json();
                    
                    addLog(`âœ… Data access successful: ${tasksData.length} tasks, ${customersData.length} customers`);
                    showResult(`âœ… Data Access: SUCCESS - ${tasksData.length} tasks, ${customersData.length} customers accessible`, true);
                    return true;
                } else {
                    addLog(`âŒ Data access failed: Tasks=${tasksResponse.status}, Customers=${customersResponse.status}`);
                    showResult(`âŒ Data Access: FAILED`, false);
                    return false;
                }
            } catch (error) {
                addLog(`âŒ Data access error: ${error.message}`);
                showResult(`âŒ Data Access: FAILED - ${error.message}`, false);
                return false;
            }
        }

        async function runAllTests() {
            results.innerHTML = '';
            log.innerHTML = '';
            addLog('ğŸš€ Starting complete mobile APK connection test...');
            
            let passed = 0;
            const total = 3;
            
            if (await testServerConnection()) passed++;
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            if (await testAuthentication()) passed++;
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            if (await testDataAccess()) passed++;
            
            addLog(`=== Test Results: ${passed}/${total} tests passed ===`);
            
            if (passed === total) {
                showResult(`ğŸ‰ ALL TESTS PASSED! Mobile APK is ready for production use.`, true);
                addLog('âœ… Mobile APK can successfully connect to production server and database!');
            } else {
                showResult(`âŒ ${total - passed} tests failed. Please check server configuration.`, false);
            }
        }

        function openMobileAPK() {
            addLog('ğŸ“± Opening Mobile APK...');
            window.open('/mobile/', '_blank');
        }

        // Auto-run basic info on load
        window.onload = function() {
            addLog('ğŸ“± Mobile APK Connection Test Ready');
            addLog(`ğŸ¯ Target: ${SERVER_URL}`);
            addLog('ğŸ”‘ Test credentials: admin/admin123');
            addLog('Click "Run All Tests" to verify complete functionality');
        };
    </script>
</body>
</html>